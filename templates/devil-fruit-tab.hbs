<section class="dft-root">
  <header class="dft-fruit" data-dft-drop="fruit" title="GM: drop an Image Journal Page here to set the fruit image/name">
    <div class="dft-fruit-left">
      {{#if fruitImg}}
        <img class="dft-fruit-img" src="{{fruitImg}}" alt="{{fruitName}}" />
      {{else}}
        <div class="dft-fruit-img-fallback">
          <i class="fa-solid fa-apple-whole"></i>
        </div>
      {{/if}}
    </div>

    <div class="dft-fruit-mid">
      <div class="dft-fruit-name">{{fruitName}}</div>

      <div class="dft-fruit-meta">
        <label class="dft-label">
          Type
          <select class="dft-select" data-action="set-type">
            <option value="paramecia" {{#if (eq fruitType "paramecia")}}selected{{/if}}>Paramecia</option>
            <option value="logia" {{#if (eq fruitType "logia")}}selected{{/if}}>Logia</option>
            <option value="zoan" {{#if (eq fruitType "zoan")}}selected{{/if}}>Zoan</option>
            <option value="hakiPurist" {{#if (eq fruitType "hakiPurist")}}selected{{/if}}>Haki Purist</option>
          </select>
        </label>

        <label class="dft-label">
          Casting Stat
          <select class="dft-select" data-action="set-casting-stat">
            <option value="cha" {{#if (eq castingStat "cha")}}selected{{/if}}>Charisma</option>
            <option value="wis" {{#if (eq castingStat "wis")}}selected{{/if}}>Wisdom</option>
            <option value="int" {{#if (eq castingStat "int")}}selected{{/if}}>Intelligence</option>
            <option value="str" {{#if (eq castingStat "str")}}selected{{/if}}>Strength</option>
            <option value="dex" {{#if (eq castingStat "dex")}}selected{{/if}}>Dexterity</option>
            <option value="con" {{#if (eq castingStat "con")}}selected{{/if}}>Constitution</option>
            <option value="willpower" {{#if (eq castingStat "willpower")}}selected{{/if}}>Willpower</option>
          </select>
        </label>

        <div class="dft-small">
          Save DC: <b>{{fruitSaveDC}}</b> • Attack: <b>{{fruitAttackModSigned}}</b>
          <span class="dft-dot">•</span>
          Highest Spell Level: <b>{{highestSpellLevel}}</b>
        </div>
      </div>
    </div>

    <div class="dft-fruit-right">
      {{#if showCharges}}
        <div class="dft-charges">
          <div class="dft-charge-top">
            <div class="dft-charge-text">
              Charges: <b>{{chargesCurrent}}</b> / <b>{{chargesMax}}</b>
              {{#if bonusCharges}}
                <span class="dft-muted">(bonus {{bonusCharges}})</span>
              {{/if}}
            </div>

            <div class="dft-charge-buttons">
              <button type="button" class="dft-btn dft-btn-small" data-action="charge-minus" title="Spend 1 charge">
                <i class="fa-solid fa-minus"></i>
              </button>
              <button type="button" class="dft-btn dft-btn-small" data-action="charge-plus" title="Regain 1 charge">
                <i class="fa-solid fa-plus"></i>
              </button>
              <button type="button" class="dft-btn dft-btn-small" data-action="charge-bonus" title="Set bonus charges">
                <i class="fa-solid fa-wand-magic-sparkles"></i>
              </button>
            </div>
          </div>

          <div class="dft-charge-bar" aria-label="Charges">
            <div class="dft-charge-fill" style="width: {{chargePct}}%;"></div>
          </div>
        </div>
      {{/if}}
    </div>
  </header>

  <section class="dft-items">
    <header class="dft-items-head">
      <div class="dft-items-title">Devil Fruit Items</div>
      <div class="dft-items-hint dft-muted">Drop items here to add them (spells, features, weapons, etc).</div>
    </header>

    <div class="dft-dropzone" data-dft-drop="items">
      <div class="dft-dropzone-inner">
        <i class="fa-solid fa-hand-pointer"></i>
        <span>Drop items here</span>
      </div>
    </div>

    {{#if hasAny}}

      {{#if spells.length}}
        <section class="dft-group">
          <header class="dft-group-head">
            <div class="dft-group-title">Spells</div>
          </header>

          <ul class="dft-list">
            {{#each spells}}
              <li class="dft-item" data-item-uuid="{{uuid}}">
                <img class="dft-item-img" src="{{img}}" alt="{{name}}" />

                <div class="dft-item-main">
                  <div class="dft-item-name">{{name}}</div>
                  <div class="dft-item-sub dft-muted">
                    Spell • Base level {{spellLevel}} • Cost {{chargeCost}}
                    {{#if allowUpcast}}
                      • Upcast +{{upcastCost}}/lvl
                    {{/if}}
                  </div>
                </div>

                <div class="dft-item-actions">
                  <button type="button" class="dft-btn dft-btn-small" data-action="use" title="Use item">
                    <i class="fa-solid fa-bolt"></i>
                  </button>
                  <button type="button" class="dft-btn dft-btn-small" data-action="open" title="Open sheet">
                    <i class="fa-solid fa-up-right-from-square"></i>
                  </button>
                  <button type="button" class="dft-btn dft-btn-small" data-action="edit" title="Configure charge cost">
                    <i class="fa-solid fa-gear"></i>
                  </button>
                  <button type="button" class="dft-btn dft-btn-small" data-action="remove" title="Remove from actor">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>
              </li>
            {{/each}}
          </ul>
        </section>
      {{/if}}

      {{#if attacks.length}}
        <section class="dft-group">
          <header class="dft-group-head">
            <div class="dft-group-title">Attacks</div>
          </header>

          <ul class="dft-list">
            {{#each attacks}}
              <li class="dft-item" data-item-uuid="{{uuid}}">
                <img class="dft-item-img" src="{{img}}" alt="{{name}}" />

                <div class="dft-item-main">
                  <div class="dft-item-name">{{name}}</div>
                  <div class="dft-item-sub dft-muted">
                    Weapon • Cost {{chargeCost}}
                  </div>
                </div>

                <div class="dft-item-actions">
                  <button type="button" class="dft-btn dft-btn-small" data-action="use" title="Use item">
                    <i class="fa-solid fa-bolt"></i>
                  </button>
                  <button type="button" class="dft-btn dft-btn-small" data-action="open" title="Open sheet">
                    <i class="fa-solid fa-up-right-from-square"></i>
                  </button>
                  <button type="button" class="dft-btn dft-btn-small" data-action="edit" title="Configure charge cost">
                    <i class="fa-solid fa-gear"></i>
                  </button>
                  <button type="button" class="dft-btn dft-btn-small" data-action="remove" title="Remove from actor">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>
              </li>
            {{/each}}
          </ul>
        </section>
      {{/if}}

      {{#if features.length}}
        <section class="dft-group">
          <header class="dft-group-head">
            <div class="dft-group-title">Features</div>
          </header>

          <ul class="dft-list">
            {{#each features}}
              <li class="dft-item" data-item-uuid="{{uuid}}">
                <img class="dft-item-img" src="{{img}}" alt="{{name}}" />

                <div class="dft-item-main">
                  <div class="dft-item-name">{{name}}</div>
                  <div class="dft-item-sub dft-muted">
                    Feature • Cost {{chargeCost}}
                  </div>
                </div>

                <div class="dft-item-actions">
                  <button type="button" class="dft-btn dft-btn-small" data-action="use" title="Use item">
                    <i class="fa-solid fa-bolt"></i>
                  </button>
                  <button type="button" class="dft-btn dft-btn-small" data-action="open" title="Open sheet">
                    <i class="fa-solid fa-up-right-from-square"></i>
                  </button>
                  <button type="button" class="dft-btn dft-btn-small" data-action="edit" title="Configure charge cost">
                    <i class="fa-solid fa-gear"></i>
                  </button>
                  <button type="button" class="dft-btn dft-btn-small" data-action="remove" title="Remove from actor">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>
              </li>
            {{/each}}
          </ul>
        </section>
      {{/if}}

      {{#if other.length}}
        <section class="dft-group">
          <header class="dft-group-head">
            <div class="dft-group-title">Other</div>
          </header>

          <ul class="dft-list">
            {{#each other}}
              <li class="dft-item" data-item-uuid="{{uuid}}">
                <img class="dft-item-img" src="{{img}}" alt="{{name}}" />

                <div class="dft-item-main">
                  <div class="dft-item-name">{{name}}</div>
                  <div class="dft-item-sub dft-muted">
                    {{type}} • Cost {{chargeCost}}
                  </div>
                </div>

                <div class="dft-item-actions">
                  <button type="button" class="dft-btn dft-btn-small" data-action="use" title="Use item">
                    <i class="fa-solid fa-bolt"></i>
                  </button>
                  <button type="button" class="dft-btn dft-btn-small" data-action="open" title="Open sheet">
                    <i class="fa-solid fa-up-right-from-square"></i>
                  </button>
                  <button type="button" class="dft-btn dft-btn-small" data-action="edit" title="Configure charge cost">
                    <i class="fa-solid fa-gear"></i>
                  </button>
                  <button type="button" class="dft-btn dft-btn-small" data-action="remove" title="Remove from actor">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>
              </li>
            {{/each}}
          </ul>
        </section>
      {{/if}}

    {{else}}
      <div class="dft-empty">
        <i class="fa-regular fa-folder-open"></i>
        <div class="dft-empty-text">No Devil Fruit items yet.</div>
      </div>
    {{/if}}
  </section>
</section>
